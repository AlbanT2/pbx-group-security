version: 0.1

environment_variables:
  plaintext:
    AWS_DEFAULT_REGION: "eu-west-2"

phases:
  install:
    commands:
      - aws s3 ls
      - echo '----------------------------------'
      - ls
      - pwd
      - curl -Ls https://github.com/gohugoio/hugo/releases/download/v0.31.1/hugo_0.31.1_Linux-64bit.tar.gz -o ./hugo.tar.gz
      - ls
      - tar xf ./hugo.tar.gz
      - ls
  build:
    commands:
      - git init
      - echo '--------------'
      - ls -la .git
      - git remote add github https://github.com/photobox/pbx-group-security.git
      - git pull -f github master
      - ./hugo
  post_build:
    commands:
      - ls public
      - aws s3 sync --acl "public-read" --sse "AES256" public/ s3://pbx-group-security.com-cdn --exclude 'post'
      - aws configure set preview.cloudfront true
      - aws cloudfront create-invalidation --distribution-id E3K53GHHL4D0LE --paths /index.html / /page/*
